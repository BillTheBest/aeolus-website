Getting the sources
-------------------

The Deltacloud project consists of two parts: **Core** and **Aggregator**. Core
gives you the API and drivers to various cloud providers. It also provides a
client library (which Aggregator uses) and a commandline interface.

Aggregator is a web frontend to the API.

In addition, there is the **docs** repository that contains the project
documentation and the sources of the <http://deltacloud.org> website.

You can browse the repositories on the web:

* [core](http://git.fedorahosted.org/git/?p=deltacloud/core.git;a=summary)
* [aggregator](http://git.fedorahosted.org/git/?p=deltacloud/aggregator.git;a=shortlog;h=refs/heads/next)
* [docs](http://git.fedorahosted.org/git/?p=deltacloud/docs.git;a=shortlog;h=refs/heads/next)

or download them to your computer:

    $ git clone git://git.fedorahosted.org/git/deltacloud/core.git/
    $ git clone --branch next git://git.fedorahosted.org/git/deltacloud/aggregator.git/
    $ git clone --branch next git://git.fedorahosted.org/git/deltacloud/docs.git/

Note that the development of the **docs** and **aggregator** takes place on the
`next` branch, which contains the latest version of the code.

If your `git` doesn't support the `--branch` option, do this instead:

    $ git clone git://git.fedorahosted.org/git/deltacloud/aggregator.git/
    $ cd aggregator
    $ git checkout -t -b next origin/next

To get the stable version, don't switch to the `next` branch at all.

Required packages
-----------------
In order to make the Deltacloud components work, you'll need to
have the following packages installed (on Fedora 12; the names may vary on
your distro):

    ruby
    ruby-devel
    gcc-c++
    libxml2-devel
    libxslt-devel
    rubygem-rails
    rubygem-gettext_rails
    rubygem-sqlite3-ruby

**Note:** these packages are necessary for building all the required ruby gems
that Deltacloud requires. If you want to install the gems using your system's
package manager (yum, apt, ports, etc.) you won't need to install these
packages manually.

We recommend using Rails version 2.3.4 or 2.3.5 (default in
Fedora 12). Older or newer versions may not be compatible at the moment.

Installing the Deltacloud Core
------------------------------

First, you need to install the server that will give you the Deltacloud API:

    $ cd path/to/deltacloud/core/server
    $ rake package
    $ sudo gem install pkg/deltacloud-core-<version>.gem

Then install the client library:

    $ cd path/to/deltacloud/core/client
    $ rake package
    $ sudo gem install deltacloud-client-<version>.gem

Once you have the client installed, run the following command:

    $ rake fixtures

Setting up the Aggregator
------------------------------------

The easiest way to get Deltacloud up and running is to use [SQLite] as the
database backend:

    $ cd aggregator/src
    $ cp config/database.sqlite config/database.yml

**Note:** you can update the paths in the "database.yml" file to change the
location of the *.sqlite3 database files.

[SQlite]: http://sqlite.org/

This command installs all the missing ruby gems:

    # rake gems:install

You can run `rake gems` to list all the required gems.

And this sets the database up:

    $ rake db:create:all
    $ rake db:migrate

Tying it all together
---------------------

**Note:** some distributions don't add the directory with the gem executables in
your PATH environment. If that is the case, add the directory manually:

    $ export PATH=$PATH:/var/lib/gems/<version>/bin

Run the Core server with the mock driver:

    $ deltacloudd -i mock

Now if you go to <http://localhost:3001/> you should be able to see a page
documenting the API. If you add the ".xml" extension to any page, you will see
the API in action.

The mock driver simulates the API behavior without making you to connect
to a real cloud provider. For a guide to connecting Deltacloud to a provider,
go to the [Drivers section of the Documentation][drivers].

[drivers]: ./drivers.html

Make sure that the `src/db` and `src/log` directories are owned by the user
who will be running the Aggregator. Note that you can change their location in
the `config/database.yml` file.

Run the Aggregator:

    $ cd path/to/deltacloud/aggregator/src
    $ ./script/server

In your web browser go to <http://localhost:3000> and create a new user.

To experience the full functionality, you should have one user with admin
privileges. Run the following command in your `deltacloud/aggregator/src`
directory (put the name of your Aggregator user in the brackets):

    $ rake dc:site_admin[aggregator_username]
